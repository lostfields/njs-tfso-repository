{"version":3,"file":"filtercriteria.js","sourceRoot":"","sources":["../../../src/repository/filters/filtercriteria.ts"],"names":[],"mappings":"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","sourcesContent":["import { IExpression, ExpressionType, ILogicalExpression, LogicalOperatorType, IMemberExpression, ILiteralExpression, IIdentifierExpression } from './../../linq/expressions/expressionvisitor';\r\n\r\nexport interface IFilterCriteria {\r\n    property: string\r\n    operator: string\r\n    value: any\r\n\r\n    isValid: boolean\r\n}\r\n\r\nexport class FilterCriteria implements IFilterCriteria {\r\n    private _expression: ILogicalExpression;\r\n\r\n    constructor(expression: ILogicalExpression) {\r\n        this._expression = expression;\r\n    }\r\n\r\n    protected get expression() {\r\n        return this._expression;\r\n    }\r\n\r\n    public get property() {\r\n        switch (this._expression.left.type) {\r\n            case ExpressionType.Member:\r\n                return (<IIdentifierExpression>(<IMemberExpression>this._expression.left).property).name;\r\n\r\n            case ExpressionType.Literal:\r\n\r\n                switch (this._expression.right.type) {\r\n                    case ExpressionType.Member:\r\n                        return (<IIdentifierExpression>(<IMemberExpression>this._expression.right).property).name;\r\n\r\n                    default:\r\n                        return \"\";\r\n\r\n                }\r\n\r\n            default:\r\n                return \"\";\r\n        }\r\n    }\r\n\r\n    public get operator() {\r\n        switch (this._expression.left.type) {\r\n            case ExpressionType.Member:\r\n                switch (this._expression.operator) {\r\n                    case LogicalOperatorType.Equal:\r\n                        return \"==\";\r\n\r\n                    case LogicalOperatorType.NotEqual:\r\n                        return \"!=\";\r\n\r\n                    case LogicalOperatorType.Greater:\r\n                        return \">\";\r\n\r\n                    case LogicalOperatorType.GreaterOrEqual:\r\n                        return \">=\";\r\n\r\n                    case LogicalOperatorType.Lesser:\r\n                        return \"<\";\r\n\r\n                    case LogicalOperatorType.LesserOrEqual:\r\n                        return \"<=\";\r\n                }\r\n\r\n                return null;\r\n\r\n            case ExpressionType.Literal:\r\n                switch (this._expression.operator) {\r\n                    case LogicalOperatorType.Equal:\r\n                        return \"==\";\r\n\r\n                    case LogicalOperatorType.NotEqual:\r\n                        return \"!=\";\r\n\r\n                    case LogicalOperatorType.Greater:\r\n                        return \"<\";\r\n\r\n                    case LogicalOperatorType.GreaterOrEqual:\r\n                        return \"<=\";\r\n\r\n                    case LogicalOperatorType.Lesser:\r\n                        return \">\";\r\n\r\n                    case LogicalOperatorType.LesserOrEqual:\r\n                        return \">=\";\r\n                }\r\n\r\n                break;\r\n\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    public get value() {\r\n        switch (this._expression.left.type) {\r\n            case ExpressionType.Literal:\r\n                return (<ILiteralExpression>this._expression.left).value;\r\n\r\n            case ExpressionType.Member:\r\n\r\n                switch (this._expression.right.type) {\r\n                    case ExpressionType.Literal:\r\n                        return (<ILiteralExpression>this._expression.right).value;\r\n\r\n                    default:\r\n                        return null;\r\n                }\r\n\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    public get isValid() {\r\n        // requires \"member.property [comparison operator] literal\" for now\r\n\r\n        switch (this._expression.left.type) {\r\n            case ExpressionType.Member:\r\n\r\n                if ((<IMemberExpression>this._expression.left).object.type == ExpressionType.Identifier && (<IMemberExpression>this._expression.left).property.type == ExpressionType.Identifier) {\r\n\r\n                    switch (this._expression.right.type) {\r\n                        case ExpressionType.Literal:\r\n                            return true;\r\n\r\n                        default:\r\n                            return false;\r\n                    }\r\n\r\n                } else {\r\n                    return false;\r\n                }\r\n\r\n            case ExpressionType.Literal:\r\n\r\n                switch (this._expression.right.type) {\r\n                    case ExpressionType.Member:\r\n                        if ((<IMemberExpression>this._expression.right).object.type == ExpressionType.Identifier && (<IMemberExpression>this._expression.right).property.type == ExpressionType.Identifier)\r\n                            return true;\r\n                        else\r\n                            return false;\r\n\r\n                    default:\r\n                        return false;\r\n                }\r\n\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n\r\n    public static visit(expression: ILogicalExpression): Array<IFilterCriteria> {\r\n        var result: Array<IFilterCriteria> = [];\r\n\r\n        switch (expression.operator) {\r\n            case LogicalOperatorType.Or:\r\n                return result;\r\n\r\n            case LogicalOperatorType.And:\r\n                if (expression.left.type == ExpressionType.Logical)\r\n                    result = result.concat(FilterCriteria.visit(<ILogicalExpression>expression.left));\r\n\r\n                if (expression.right.type == ExpressionType.Logical)\r\n                    result = result.concat(FilterCriteria.visit(<ILogicalExpression>expression.right));\r\n\r\n                break;\r\n\r\n            default:\r\n                result.push(new FilterCriteria(expression));\r\n                break;\r\n        }\r\n\r\n        return result.filter((criteria) => criteria.isValid);\r\n    }\r\n\r\n}"]}